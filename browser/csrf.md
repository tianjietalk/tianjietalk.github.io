# CSRF 攻击

hacker 引诱用户打开其恶意链接，利用用户的登录状态，向第三方站点发出跨站请求。

## 分类

### 自动发起 GET 请求

hacker 的 HTML 代码里，将请求接口隐藏在 img 标签内，浏览器会认为这是图片资源，在页面加载时，发起 img 的 GET 请求，服务器没有判断请求的话，就会被攻击成功。

### 自动发起 POST 请求

hacker 在其站点伪造 POST 请求，例如构造隐藏表单，使用户打开站点就触发 POST 请求。

### 引诱用户点击链接

链接地址实则指向恶意接口。

## 如何防止 CSRF 攻击

CSRF 实施的必要条件是：

1. 站点存在 CSRF 漏洞
2. 用户已登录站点，且保持登录状态
3. 用户需要点击链接

### 为 Cookie 设置 SameSite 属性

Cookie 是维持登录状态的关键证据，浏览器发送 HTTP 请求时需要区分：

- 从第三方站点发起的请求，禁止发送 Cookie 数据到服务器
- 同一站点发起的请求，可以保证 Cookie 正常发送。

SameSite 有三个值，通过设置不同的值，不同程度地限制 Cookie 的发送：

- Strict，浏览器完全禁止第三方站点发送 Cookie 到服务器
- Lax，在第三方站点链接打开或者从第三方站点提交 GET 方式的表单，可以携带 Cookie；如果是 POST 方法，或者 img、iframe 标签加载 URL，不允许携带 Cookie
- None，任何情况都可以发送 Cookie

### 验证请求的来源站点

设置 HTTP 请求的 Referer 和 Origin 属性。

Referer 表示该 HTTP 请求的来源地址，交由服务器判断，是否处理此条请求。

Origin 只包含 HTTP 请求站点的域名信息，没有具体的 URL，保护源站点。

### CSRF Token

Token 可以验证请求站点的合法性。

1. 浏览器向服务器发起请求时，服务器生成 CSRF Token，这段字符串嵌入在返回的页面中。
2. 浏览器发起请求时，需要带上页面中的 CSRF，让服务器验证。从第三方站点发出的请求，是没有 Token 的，服务器就可以拒绝请求。
